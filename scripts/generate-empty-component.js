#!/usr/bin/env node

const fs = require('fs')
const path = require('path')
const readline = require('readline')

// ÂàõÂª∫ËØªÂèñÊé•Âè£
const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
})

// ÊèêÁ§∫Áî®Êà∑ËæìÂÖ•ÁªÑ‰ª∂‰ø°ÊÅØ
function askQuestion(question) {
  return new Promise((resolve) => {
    rl.question(question, (answer) => {
      resolve(answer)
    })
  })
}

// ÁªÑ‰ª∂Á±ªÂûãÈÄâÊã©
function askComponentType() {
  return new Promise((resolve) => {
    console.log('\nüìã ËØ∑ÈÄâÊã©ÁªÑ‰ª∂Á±ªÂûã:')
    console.log('1. ÈùôÊÄÅÁªÑ‰ª∂ (Static Component) - Á∫ØÂ±ïÁ§∫ÂûãÔºå‰∏ç‰æùËµñÊ∏∏ÊàèÊï∞ÊçÆ')
    console.log('2. Âä®ÊÄÅÁªÑ‰ª∂ (Dynamic Component) - ‰æùËµñÊ∏∏ÊàèÁ±ªÂûãÊï∞ÊçÆÔºå‰∏é gameType store ÈõÜÊàê')
    rl.question('ËØ∑ËæìÂÖ•ÈÄâÊã© (1 Êàñ 2): ', (answer) => {
      const choice = answer.trim()
      if (choice === '1') {
        resolve('static')
      } else if (choice === '2') {
        resolve('dynamic')
      } else {
        console.log('‚ùå Êó†ÊïàÈÄâÊã©ÔºåÈªòËÆ§ÈÄâÊã©ÈùôÊÄÅÁªÑ‰ª∂')
        resolve('static')
      }
    })
  })
}

// ËΩ¨Êç¢‰∏∫ PascalCase
function toPascalCase(str) {
  return str
    .replace(/(?:^\w|[A-Z]|\b\w)/g, (word, index) => {
      return word.toUpperCase()
    })
    .replace(/\s+/g, '')
}

// ËΩ¨Êç¢‰∏∫ camelCase
function toCamelCase(str) {
  const pascal = toPascalCase(str)
  return pascal.charAt(0).toLowerCase() + pascal.slice(1)
}

// ÁîüÊàêÈùôÊÄÅÁªÑ‰ª∂Êñá‰ª∂
function generateStaticComponent(componentName, componentDisplayName, componentDescription) {
  return `<script setup lang="ts" name="${componentName}">
import { computed, defineProps } from 'vue'
import type { IDatas } from './type'

interface IProps {
  datas: IDatas
}
const props = defineProps<IProps>()
const styleHeader = computed(() => props.datas.configParamJson.styleHeader)
const styleMain = computed(() => props.datas.configParamJson.styleMain)

// style Ê†∑Âºè
const containerStyle = computed(() => {
  return {
    borderRadius: \`\${styleMain.value?.borderRadius || 0}px\`,
    padding: \`\${styleMain.value?.padding || 0}px\`,
    backgroundColor: styleMain.value?.backgroundColor || '#ffffff'
  }
})

const titleHeaderStyle = computed(() => {
  if (styleHeader.value.isGradient) {
    return {
      background: \`linear-gradient(to right,  \${styleHeader.value.headerBg}, \${styleHeader.value.headerBg2})\`
    }
  }
  return {
    backgroundColor: styleHeader.value?.headerBgColor || '#4a90e2'
  }
})

const mainTitleStyle = computed(() => {
  return {
    color: styleHeader.value?.titleColor || '#333333'
  }
})

const subTitleStyle = computed(() => {
  return {
    color: styleHeader.value?.subTitleColor || '#333333'
  }
})

const contentStyle = computed(() => {
  return {
    color: styleMain.value?.textColor || '#333333',
    fontSize: \`\${styleMain.value?.fontSize || 14}px\`,
    fontWeight: styleMain.value?.fontWeight || 400,
    textAlign: styleMain.value?.textAlign || 'center'
  }
})
</script>

<template>
  <div class="${componentName}">
    <div class="${componentName}-content" :style="containerStyle">
      <!-- Â§¥ÈÉ®Ê†áÈ¢ò -->
      <div class="title-header" :style="titleHeaderStyle">
        <h2 class="main-title" :style="mainTitleStyle">{{ datas.configParamJson.title }}</h2>
        <span class="sub-title" :style="subTitleStyle">{{ datas.configParamJson.subtitle }}</span>
      </div>
      <!-- ÂÜÖÂÆπÂå∫Âüü -->
      <div class="content-area" :style="contentStyle">
        {{ datas.configParamJson.content }}
      </div>
    </div>
    <slot name="deles" />
  </div>
</template>

<style scoped lang="scss">
.${componentName} {
  position: relative;
}

.title-header {
  padding: 12px 16px;
  border-radius: 8px 8px 0 0;
  display: flex;
  align-items: center;
  justify-content: space-between;

  .main-title {
    margin: 0;
    font-size: 18px;
    font-weight: bold;
  }

  .sub-title {
    font-size: 14px;
    opacity: 0.9;
  }
}

.content-area {
  padding: 16px;
  min-height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  word-wrap: break-word;
  white-space: pre-wrap;
}
</style>`
}

// ÁîüÊàêÂä®ÊÄÅÁªÑ‰ª∂Êñá‰ª∂
function generateDynamicComponent(componentName, componentDisplayName, componentDescription) {
  return `<script setup lang="ts" name="${componentName}">
import { computed, ref, watch, onMounted, reactive } from 'vue'
import { useStore } from '@nanostores/vue'
import { Loading } from '@element-plus/icons-vue'
import { gameStore } from '../store/index'
import type { IDatas } from './type'

interface IProps {
  datas: IDatas
}
const props = defineProps<IProps>()

// üéÆ gameType Store ÈõÜÊàê - Âä®ÊÄÅÁªÑ‰ª∂ÂøÖÈúÄ
const gameStoreData = useStore(gameStore)
const gameType = computed(() => gameStoreData.value.gameType)
const currentGame = computed(() => gameStoreData.value.currentGame)
const currentGameName = computed(() => currentGame.value?.name || 'Êú™Áü•Ê∏∏Êàè')

// üîÑ ÂìçÂ∫îÂºèÂèÇÊï∞ÂØπË±°Ôºå‰∏éÈÖçÁΩÆÂêåÊ≠•
const componentParams = reactive({
  gameType: props.datas.configParamJson.gameType || gameType.value,
  size: props.datas.configParamJson.size || 10,
  forumId: props.datas.configParamJson.forumId || '10'
})

// ÁªÑ‰ª∂Áä∂ÊÄÅ
const loading = ref(false)
const gameData = ref([])
const error = ref(null)

// Ê†∑ÂºèËÆ°ÁÆó
const styleHeader = computed(() => props.datas.configParamJson.styleHeader)
const styleMain = computed(() => props.datas.configParamJson.styleMain)

const containerStyle = computed(() => ({
  backgroundColor: styleMain.value?.backgroundColor || '#ffffff',
  borderRadius: \`\${styleMain.value?.borderRadius || 0}px\`,
  padding: \`\${styleMain.value?.padding || 16}px\`,
  margin: \`\${styleMain.value?.margin || 0}px\`
}))

const titleHeaderStyle = computed(() => {
  if (styleHeader.value?.isGradient) {
    return {
      background: \`linear-gradient(to right, \${styleHeader.value.headerBg}, \${styleHeader.value.headerBg2})\`
    }
  }
  return {
    backgroundColor: styleHeader.value?.headerBgColor || '#4a90e2'
  }
})

const mainTitleStyle = computed(() => ({
  color: styleHeader.value?.titleColor || '#ffffff'
}))

const subTitleStyle = computed(() => ({
  color: styleHeader.value?.subTitleColor || '#ffffff'
}))

const contentStyle = computed(() => ({
  color: styleMain.value?.textColor || '#333333',
  fontSize: \`\${styleMain.value?.fontSize || 14}px\`,
  fontWeight: styleMain.value?.fontWeight || 400,
  textAlign: styleMain.value?.textAlign || 'center',
  lineHeight: '1.5'
}))

// üéÆ Ê∏∏ÊàèÁõ∏ÂÖ≥Êï∞ÊçÆËé∑Âèñ
const fetchGameData = async (gameType: string) => {
  if (!gameType) return
  
  loading.value = true
  error.value = null
  
  try {
    // TODO: Ê†πÊçÆÂÖ∑‰ΩìÈúÄÊ±ÇÂÆûÁé∞Êï∞ÊçÆËé∑ÂèñÈÄªËæë
    console.log(\`üéÆ Ëé∑ÂèñÊ∏∏ÊàèÊï∞ÊçÆ: \${gameType}\`)
    
    // Ê®°ÊãüAPIË∞ÉÁî®
    // const response = await fetchSpecificGameData(gameType)
    // gameData.value = response.data || []
    
    // ‰∏¥Êó∂Êï∞ÊçÆ
    gameData.value = [
      { id: 1, title: \`\${currentGameName.value}Êï∞ÊçÆ1\`, content: 'Á§∫‰æãÂÜÖÂÆπ' },
      { id: 2, title: \`\${currentGameName.value}Êï∞ÊçÆ2\`, content: 'Á§∫‰æãÂÜÖÂÆπ' }
    ]
  } catch (err) {
    error.value = err
    console.error('Ëé∑ÂèñÊ∏∏ÊàèÊï∞ÊçÆÂ§±Ë¥•:', err)
  } finally {
    loading.value = false
  }
}

// üéØ ÁõëÂê¨Ê∏∏ÊàèÁ±ªÂûãÂèòÂåñ - ÂÖ®Â±ÄstoreÂèòÂåñ
watch(gameType, (newGameType) => {
  if (newGameType) {
    componentParams.gameType = newGameType
    console.log(\`üéÆ ÂÖ®Â±ÄÊ∏∏ÊàèÁ±ªÂûãÂèòÂåñ: \${newGameType}\`)
    fetchGameData(newGameType)
  }
}, { immediate: true })

// üìä ÁõëÂê¨ÁªÑ‰ª∂ÈÖçÁΩÆÂèòÂåñ
watch(
  () => [props.datas.configParamJson.gameType, props.datas.configParamJson.size, props.datas.configParamJson.forumId],
  ([newGameType, newSize, newForumId]) => {
    if (newGameType) componentParams.gameType = newGameType
    if (newSize) componentParams.size = Number(newSize)
    if (newForumId) componentParams.forumId = String(newForumId)
    
    // ÂΩìÈÖçÁΩÆÁöÑgameTypeÂèòÂåñÊó∂ÔºåÈáçÊñ∞Ëé∑ÂèñÊï∞ÊçÆ
    if (newGameType && newGameType !== componentParams.gameType) {
      fetchGameData(newGameType)
    }
  },
  { deep: true }
)

// üéÆ Ê∏∏ÊàèÂàáÊç¢ÁõëÂê¨
watch(currentGame, (newGame) => {
  if (newGame) {
    fetchGameData(newGame.type || gameType.value)
  }
})

onMounted(() => {
  if (gameType.value) {
    fetchGameData(gameType.value)
  }
})
</script>

<template>
  <div class="${componentName}">
    <div 
      class="${componentName.toLowerCase()}-content" 
      :style="containerStyle"
      v-if="datas.configParamJson.enable"
    >
      <!-- Ê†áÈ¢òÂå∫Âüü - ÊîØÊåÅÂä®ÊÄÅÊ∏∏ÊàèÂêçÁß∞ -->
      <div v-if="datas.configParamJson.title" class="title-header" :style="titleHeaderStyle">
        <h2 class="main-title" :style="mainTitleStyle">
          {{ datas.configParamJson.title }} - {{ currentGameName }}
        </h2>
        <span v-if="datas.configParamJson.subtitle" class="sub-title" :style="subTitleStyle">
          {{ datas.configParamJson.subtitle }}
        </span>
      </div>
      
      <!-- Âä®ÊÄÅÂÜÖÂÆπÂå∫Âüü -->
      <div class="content-area" :style="contentStyle">
        <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
        <div v-if="loading" class="loading-state">
          <el-icon class="is-loading"><Loading /></el-icon>
          <span>Ê≠£Âú®Âä†ËΩΩ{{ currentGameName }}Êï∞ÊçÆ...</span>
        </div>
        
        <!-- Êï∞ÊçÆÂ±ïÁ§∫ -->
        <div v-else-if="gameData && gameData.length > 0" class="game-data-list">
          <div 
            v-for="(item, index) in gameData" 
            :key="item.id || index"
            class="game-data-item"
          >
            <div class="item-title">{{ item.title }}</div>
            <div class="item-content">{{ item.content }}</div>
          </div>
        </div>
        
        <!-- Á©∫Áä∂ÊÄÅ -->
        <div v-else class="empty-state">
          <el-empty :description="\`ÊöÇÊó†\${currentGameName}Êï∞ÊçÆ\`" />
        </div>
      </div>
    </div>
    
    <!-- ÂøÖÈúÄÁöÑÂà†Èô§ÊåâÈíÆÊèíÊßΩ -->
    <slot name="deles" />
  </div>
</template>

<style scoped lang="scss">
.${componentName} {
  position: relative;
  
  .${componentName.toLowerCase()}-content {
    // Âä®ÊÄÅÊ†∑ÂºèÈÄöËøá computed Â±ûÊÄßÊéßÂà∂
  }
  
  .title-header {
    padding: 12px 16px;
    border-radius: 8px 8px 0 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    
    .main-title {
      margin: 0;
      font-size: 18px;
      font-weight: bold;
    }
    
    .sub-title {
      font-size: 14px;
      opacity: 0.9;
    }
  }
  
  .content-area {
    padding: 16px;
    min-height: 120px;
    
    .loading-state {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 40px;
      color: #666;
    }
    
    .game-data-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      
      .game-data-item {
        padding: 12px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        transition: all 0.3s ease;
        
        &:hover {
          border-color: #4a90e2;
          box-shadow: 0 2px 8px rgba(74, 144, 226, 0.1);
        }
        
        .item-title {
          font-weight: 600;
          color: #333;
          margin-bottom: 4px;
        }
        
        .item-content {
          color: #666;
          font-size: 14px;
        }
      }
    }
    
    .empty-state {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }
  }
  
  // ÂìçÂ∫îÂºèËÆæËÆ°
  @media (max-width: 768px) {
    .title-header {
      padding: 8px 12px;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
    }
    
    .content-area {
      padding: 12px;
      
      .game-data-item {
        padding: 8px;
      }
    }
  }
}
</style>`
}

// ÁîüÊàêÁ±ªÂûãÂÆö‰πâÊñá‰ª∂
function generateTypeFile(componentName, componentDisplayName, componentType) {
  return `import type { ISetStyle } from '../componentProperties/index'

export interface IDatas extends ISetStyle<${componentName}Config> {}

export interface ${componentName}Config {
  title: string
  subtitle: string
  content: string
  enable: boolean
  ${
    componentType === 'dynamic'
      ? `showGameType: boolean
  gameType: string
  gameTypeCode: string
  forumId: string
  size: number`
      : ''
  }
  styleHeader: IStyleHeader
  styleMain: IStyleMain
}

export interface IStyleMain {
  padding: number
  borderRadius: number
  backgroundColor: string
  textAlign: 'left' | 'center' | 'right'
  fontSize: number
  fontWeight: number
  textColor: string
}

export interface IStyleHeader {
  backgroundColor: string
  isGradient: boolean
  headerBgColor: string
  headerBg: string
  headerBg2: string
  subTitleColor: string
  titleColor: string
}`
}

// ÁîüÊàêÈÖçÁΩÆÈù¢ÊùøÊñá‰ª∂
function generateStyleComponent(componentName, componentDisplayName, componentType) {
  return `<script setup lang="ts" name="${componentName}Style">
import { ref, computed, defineProps } from 'vue'
import shareComponent from '@/views/WebVision/components/rightslider/shareComponent/index.vue'
import componentHeadTitle from '@/views/WebVision/components/rightslider/componentHeadTitle/index.vue'
import headerTitle from '@/views/WebVision/components/rightslider/headerTitle/index.vue'
${
  componentType === 'dynamic'
    ? "import StoreGameTypeList from '@/views/WebVision/components/rightslider/StoreGameTypeList/index.vue'"
    : ''
}

import type { FormInstance } from 'element-plus'
import type { IDatas } from '@/views/WebVision/components/componentsbiz/${componentName}/type'

interface IProps {
  datas: IDatas
}
const props = defineProps<IProps>()

const rules = ref({})
const ruleFormRef = ref<FormInstance>()

const textAlignOptions = ref([
  {
    label: 'Â∑¶ÂØπÈΩê',
    value: 'left'
  },
  {
    label: 'Â±Ö‰∏≠',
    value: 'center'
  },
  {
    label: 'Âè≥ÂØπÈΩê',
    value: 'right'
  }
])
</script>

<template>
  <div class="${componentName}Style">
    <h2>{{ datas.componentName }}</h2>
    <el-form label-width="auto" ref="ruleFormRef" :model="datas" :rules="rules" class="lef">
      <!-- ÁªÑ‰ª∂Âü∫Êú¨‰ø°ÊÅØÈÖçÁΩÆ -->
      <share-component :datas="datas" />
      <!-- ‰ª•‰∏ãÊòØÁªÑ‰ª∂ÁöÑÊ†∑Âºè„ÄÅÊï∞ÊçÆÈÖçÁΩÆ -->
      <componentHeadTitle :datas="datas" />
      <!-- HeaderÊ†∑ÂºèÈÖçÁΩÆ -->
      <header-title :datas="datas" />
      
      ${
        componentType === 'dynamic'
          ? `<!-- Ê∏∏ÊàèÁ±ªÂûãÈÄâÊã©ÈÖçÁΩÆ - Âä®ÊÄÅÁªÑ‰ª∂ÂøÖÈúÄ -->
      <StoreGameTypeList :datas="datas" />`
          : ''
      }

      <el-form-item label="ÂÜÖÂÆπÊñáÊú¨" prop="content">
        <el-input 
          v-model="datas.configParamJson.content" 
          type="textarea"
          :rows="3"
          placeholder="ËØ∑ËæìÂÖ•ÂÜÖÂÆπÊñáÊú¨" 
        />
      </el-form-item>

      <el-form-item label="ÊòØÂê¶ÂêØÁî®" prop="enable">
        <el-switch v-model="datas.configParamJson.enable" />
      </el-form-item>

      ${
        componentType === 'dynamic'
          ? `<el-form-item label="ÊòæÁ§∫Ê∏∏ÊàèÁ±ªÂûã" prop="showGameType">
        <el-switch v-model="datas.configParamJson.showGameType" />
      </el-form-item>

      <el-form-item label="Êï∞ÊçÆÊù°Êï∞" prop="size">
        <el-input-number 
          v-model="datas.configParamJson.size" 
          :min="1" 
          :max="50" 
          placeholder="ËØ∑ËæìÂÖ•Êï∞ÊçÆÊù°Êï∞" 
        />
      </el-form-item>

      <el-form-item label="ËÆ∫ÂùõID" prop="forumId">
        <el-input 
          v-model="datas.configParamJson.forumId" 
          placeholder="ËØ∑ËæìÂÖ•ËÆ∫ÂùõID" 
        />
      </el-form-item>`
          : ''
      }

      <!-- Ê†∑ÂºèËÆæÁΩÆ -->
      <el-divider content-position="left">Ê†∑ÂºèÈÖçÁΩÆ</el-divider>

      <el-form-item label="ËÉåÊôØÈ¢úËâ≤" prop="backgroundColor">
        <el-color-picker v-model="datas.configParamJson.styleMain.backgroundColor" show-alpha />
      </el-form-item>

      <el-form-item label="ÊñáÂ≠óÈ¢úËâ≤" prop="textColor">
        <el-color-picker v-model="datas.configParamJson.styleMain.textColor" show-alpha />
      </el-form-item>

      <el-form-item label="ÊñáÂ≠óÂ§ßÂ∞è" prop="fontSize">
        <el-slider
          v-model="datas.configParamJson.styleMain.fontSize"
          :min="12"
          :max="32"
          show-input
        />
        <span style="margin-left: 8px">px</span>
      </el-form-item>

      <el-form-item label="ÊñáÂ≠óÁ≤óÁªÜ" prop="fontWeight">
        <el-select v-model="datas.configParamJson.styleMain.fontWeight" placeholder="ËØ∑ÈÄâÊã©ÊñáÂ≠óÁ≤óÁªÜ">
          <el-option :value="400" label="Ê≠£Â∏∏ (400)" />
          <el-option :value="500" label="‰∏≠Á≠â (500)" />
          <el-option :value="600" label="ËæÉÁ≤ó (600)" />
          <el-option :value="700" label="Á≤ó‰Ωì (700)" />
          <el-option :value="800" label="ÁâπÁ≤ó (800)" />
        </el-select>
      </el-form-item>

      <el-form-item label="ÊñáÂ≠óÂØπÈΩê" prop="textAlign">
        <el-radio-group v-model="datas.configParamJson.styleMain.textAlign">
          <el-radio v-for="item in textAlignOptions" :key="item.value" :value="item.value">
            {{ item.label }}
          </el-radio>
        </el-radio-group>
      </el-form-item>

      <el-form-item label="ÂúÜËßí" prop="borderRadius">
        <el-slider
          v-model="datas.configParamJson.styleMain.borderRadius"
          :min="0"
          :max="30"
          show-input
        />
        <span style="margin-left: 8px">px</span>
      </el-form-item>

      <el-form-item label="ÂÜÖËæπË∑ù" prop="padding">
        <el-slider
          v-model="datas.configParamJson.styleMain.padding"
          :min="0"
          :max="50"
          show-input
        />
        <span style="margin-left: 8px">px</span>
      </el-form-item>
    </el-form>
  </div>
</template>

<style lang="scss" scoped>
.${componentName}Style {
  .content-preview {
    border: 1px solid #e4e7ed;
    border-radius: 8px;
    padding: 16px;
    margin-top: 12px;
    background: #fafafa;
    
    .preview-label {
      font-size: 12px;
      color: #909399;
      margin-bottom: 8px;
    }
    
    .preview-content {
      border: 1px dashed #d3d3d3;
      padding: 20px;
      border-radius: 4px;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #909399;
    }
  }
}
</style>`
}

// ÁîüÊàêÂ±ûÊÄßÈÖçÁΩÆÊñá‰ª∂
function generatePropertiesFile(componentName, componentDisplayName, componentDescription, componentType) {
  return `import type { ${componentName}Config } from '../${componentName}/type'
import type { IComponentProperty, ISetStyle } from './index'

const componentProperties = new Map<string, IComponentProperty<ISetStyle<${componentName}Config>>>()

componentProperties.set('${componentName}', {
  component: '${componentName}',
  text: '${componentDisplayName}',
  active: false,
  style: '${componentName}Style',
  setStyle: {
    componentId: '',
    sketchCodeList: '',
    templateId: '',
    pageRenderingSeq: 0,
    websiteId: '',
    componentRef: '',
    componentName: '${componentDisplayName}',
    componentType: '${componentName}',
    componentSort: '',
    status: '',
    isView: '',
    memo: '',
    pageCode: '',
    configParamJson: {
      title: '${componentDisplayName}',
      subtitle: 'ËøôÊòØ‰∏Ä‰∏™${componentDisplayName}',
      content: 'ËøôÈáåÊòØÂÜÖÂÆπÂå∫ÂüüÔºåÊÇ®ÂèØ‰ª•Âú®Ê≠§Â§ÑÊ∑ªÂä†‰ªª‰ΩïÊñáÊú¨ÂÜÖÂÆπ„ÄÇ',
      enable: true,
      ${
        componentType === 'dynamic'
          ? `showGameType: false,
      gameType: '2032',
      gameTypeCode: 'a6',
      forumId: '10',
      size: 10,`
          : ''
      }
      styleHeader: {
        backgroundColor: '#f8f9fa',
        isGradient: true,
        headerBgColor: '#4a90e2',
        headerBg: '#4a90e2',
        headerBg2: '#5aa5f0',
        subTitleColor: '#ffffff',
        titleColor: '#ffffff'
      },
      styleMain: {
        padding: 16,
        borderRadius: 8,
        backgroundColor: '#ffffff',
        textAlign: 'center',
        fontSize: 14,
        fontWeight: 400,
        textColor: '#333333'
      }
    }
  }
})

export default componentProperties`
}

// ÂàõÂª∫ÁõÆÂΩï
function ensureDirectoryExists(dirPath) {
  if (!fs.existsSync(dirPath)) {
    fs.mkdirSync(dirPath, { recursive: true })
  }
}

// ÂÜôÂÖ•Êñá‰ª∂
function writeFile(filePath, content) {
  ensureDirectoryExists(path.dirname(filePath))
  fs.writeFileSync(filePath, content, 'utf8')
}

// Êõ¥Êñ∞ÁªÑ‰ª∂Â±ûÊÄßÁ¥¢ÂºïÊñá‰ª∂
function updateComponentPropertiesIndex(componentName) {
  const indexPath = path.join(
    process.cwd(),
    'src/views/WebVision/components/componentsbiz/componentProperties/index.ts'
  )

  if (!fs.existsSync(indexPath)) {
    throw new Error(`ÁªÑ‰ª∂Â±ûÊÄßÁ¥¢ÂºïÊñá‰ª∂‰∏çÂ≠òÂú®: ${indexPath}`)
  }

  const content = fs.readFileSync(indexPath, 'utf8')

  // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂØºÂÖ•‰∫ÜËØ•ÁªÑ‰ª∂
  const importPattern = new RegExp(`import\\s+${componentName}Properties\\s+from`, 'g')
  if (importPattern.test(content)) {
    console.log(`‚ö†Ô∏è  ÁªÑ‰ª∂ ${componentName} Â∑≤ÁªèÂ≠òÂú®‰∫éÁ¥¢ÂºïÊñá‰ª∂‰∏≠ÔºåË∑≥ËøáÂØºÂÖ•`)
    return
  }

  const importLine = `import ${componentName}Properties from './${componentName}'`
  const mergeCode = `${componentName}Properties.forEach((value, key) => {
  allComponentProperties.set(key, value)
})`

  let newContent = content

  // 1. Ê∑ªÂä†ÂØºÂÖ•ËØ≠Âè• - Âú®ÊâÄÊúâ import ËØ≠Âè•‰πãÂêé
  const lastImportPattern = /(import\s+.*Properties\s+from\s+.*\n)(?!import)/
  const importMatches = [...content.matchAll(/import\s+.*Properties\s+from\s+.*\n/g)]

  if (importMatches.length > 0) {
    const lastImport = importMatches[importMatches.length - 1]
    const insertIndex = lastImport.index + lastImport[0].length
    newContent = newContent.slice(0, insertIndex) + importLine + '\n' + newContent.slice(insertIndex)
  } else {
    // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÂÖ∂‰ªñ Properties ÂØºÂÖ•ÔºåÂú® '// ÂêàÂπ∂ÊâÄÊúâÁªÑ‰ª∂ÈÖçÁΩÆ' Ê≥®ÈáäÂâçÊ∑ªÂä†
    const beforeMergeComment = newContent.indexOf('// ÂêàÂπ∂ÊâÄÊúâÁªÑ‰ª∂ÈÖçÁΩÆ')
    if (beforeMergeComment !== -1) {
      newContent = newContent.slice(0, beforeMergeComment) + importLine + '\n\n' + newContent.slice(beforeMergeComment)
    } else {
      throw new Error('Êó†Ê≥ïÊâæÂà∞ÂêàÈÄÇÁöÑ‰ΩçÁΩÆÊèíÂÖ•ÂØºÂÖ•ËØ≠Âè•')
    }
  }

  // 2. Ê∑ªÂä†ÂêàÂπ∂‰ª£Á†Å - Âú® export ËØ≠Âè•‰πãÂâç
  const exportPattern = /(\n)(export\s+default\s+allComponentProperties)/
  if (!exportPattern.test(newContent)) {
    throw new Error('Êó†Ê≥ïÊâæÂà∞ export default allComponentProperties ËØ≠Âè•')
  }

  newContent = newContent.replace(exportPattern, `\n${mergeCode}\n\n$2`)

  fs.writeFileSync(indexPath, newContent, 'utf8')
}

// Êõ¥Êñ∞Â∑¶‰æßÁªÑ‰ª∂Â∫ì
function updateSliderAssembly(componentName, componentDisplayName, iconName = 'icon-zidingyimokuai') {
  const sliderPath = path.join(process.cwd(), 'src/views/WebVision/components/sliderassembly/index.vue')

  if (!fs.existsSync(sliderPath)) {
    throw new Error(`Â∑¶‰æßÁªÑ‰ª∂Â∫ìÊñá‰ª∂‰∏çÂ≠òÂú®: ${sliderPath}`)
  }

  const content = fs.readFileSync(sliderPath, 'utf8')

  // Ê£ÄÊü•ÁªÑ‰ª∂ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®‰∫éÂ∑¶‰æßÁªÑ‰ª∂Â∫ì‰∏≠
  const componentPattern = new RegExp(`name:\\s*['"\`]${componentName}['"\`]`, 'g')
  if (componentPattern.test(content)) {
    console.log(`‚ö†Ô∏è  ÁªÑ‰ª∂ ${componentName} Â∑≤ÁªèÂ≠òÂú®‰∫éÂ∑¶‰æßÁªÑ‰ª∂Â∫ì‰∏≠ÔºåË∑≥ËøáÊ∑ªÂä†`)
    return
  }

  // ÂàõÂª∫Êñ∞ÁªÑ‰ª∂È°π
  const newComponentItem = `      {
        text: '${componentDisplayName}',
        icon: '${iconName}',
        name: '${componentName}'
      }`

  // Êõ¥ÂÅ•Â£ÆÁöÑÊñπÊ≥ïÔºöÊâæÂà∞"È°µÈù¢ÁªÑ‰ª∂"ÂàÜÁªÑÔºåÁÑ∂ÂêéÂú®ÂÖ∂ comList Êï∞ÁªÑÊú´Â∞æÊèíÂÖ•
  // 1. ÊâæÂà∞ "È°µÈù¢ÁªÑ‰ª∂" Ê†áÈ¢ò
  // 2. ÊâæÂà∞ÂØπÂ∫îÁöÑ comList Êï∞ÁªÑÁªìÂ∞æ
  // 3. Âú®ÊúÄÂêé‰∏Ä‰∏™ÁªÑ‰ª∂ÂêéÊ∑ªÂä†Êñ∞ÁªÑ‰ª∂

  const pageComponentsPattern = /(title: 'È°µÈù¢ÁªÑ‰ª∂',\s*comList: \[[\s\S]*?)(\n\s*\]\s*\})/

  if (!pageComponentsPattern.test(content)) {
    throw new Error('Êó†Ê≥ïÊâæÂà∞"È°µÈù¢ÁªÑ‰ª∂"ÂàÜÁªÑÔºåËØ∑Ê£ÄÊü• sliderassembly/index.vue Êñá‰ª∂ÁªìÊûÑ')
  }

  const newContent = content.replace(pageComponentsPattern, (match, beforeClosing, closing) => {
    // Ê£ÄÊü•ÊúÄÂêé‰∏Ä‰∏™ÁªÑ‰ª∂ÊòØÂê¶ÊúâÈÄóÂè∑
    const trimmedBefore = beforeClosing.trim()
    const needsComma = !trimmedBefore.endsWith(',')

    return beforeClosing + (needsComma ? ',' : '') + '\n' + newComponentItem + closing
  })

  if (newContent === content) {
    throw new Error('ÁªÑ‰ª∂Ê∑ªÂä†Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºèÊòØÂê¶Ê≠£Á°Æ')
  }

  fs.writeFileSync(sliderPath, newContent, 'utf8')
}

// Ê£ÄÊü•ÁªÑ‰ª∂ÊòØÂê¶Â∑≤Â≠òÂú®
function checkComponentExists(componentName) {
  const basePath = path.join(process.cwd(), 'src/views/WebVision/components')
  const componentPath = path.join(basePath, 'componentsbiz', componentName)
  const stylePath = path.join(basePath, 'rightslider', `${componentName}Style`)
  const propertiesPath = path.join(basePath, 'componentsbiz/componentProperties', `${componentName}.ts`)

  const existingFiles = []
  if (fs.existsSync(componentPath)) existingFiles.push(`componentsbiz/${componentName}/`)
  if (fs.existsSync(stylePath)) existingFiles.push(`rightslider/${componentName}Style/`)
  if (fs.existsSync(propertiesPath)) existingFiles.push(`componentProperties/${componentName}.ts`)

  return existingFiles
}

// È™åËØÅËæìÂÖ•
function validateInputs(componentName, componentDisplayName, componentDescription) {
  const errors = []

  if (!componentName || componentName.trim() === '') {
    errors.push('ÁªÑ‰ª∂ÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫')
  } else if (!/^[A-Z][a-zA-Z0-9]*$/.test(componentName)) {
    errors.push('ÁªÑ‰ª∂ÂêçÁß∞ÂøÖÈ°ªÊòØÊúâÊïàÁöÑ PascalCase Ê†ºÂºè (Â¶Ç: MyComponent)')
  } else if (componentName.length < 2) {
    errors.push('ÁªÑ‰ª∂ÂêçÁß∞Ëá≥Â∞ëÈúÄË¶Å2‰∏™Â≠óÁ¨¶')
  } else if (componentName.length > 50) {
    errors.push('ÁªÑ‰ª∂ÂêçÁß∞‰∏çËÉΩË∂ÖËøá50‰∏™Â≠óÁ¨¶')
  }

  if (!componentDisplayName || componentDisplayName.trim() === '') {
    errors.push('ÁªÑ‰ª∂ÊòæÁ§∫ÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫')
  } else if (componentDisplayName.length > 20) {
    errors.push('ÁªÑ‰ª∂ÊòæÁ§∫ÂêçÁß∞‰∏çËÉΩË∂ÖËøá20‰∏™Â≠óÁ¨¶')
  }

  if (!componentDescription || componentDescription.trim() === '') {
    errors.push('ÁªÑ‰ª∂ÊèèËø∞‰∏çËÉΩ‰∏∫Á©∫')
  } else if (componentDescription.length > 100) {
    errors.push('ÁªÑ‰ª∂ÊèèËø∞‰∏çËÉΩË∂ÖËøá100‰∏™Â≠óÁ¨¶')
  }

  return errors
}

// ‰∏ªÂáΩÊï∞
async function main() {
  console.log('üöÄ WebVision Á©∫ÁôΩÁªÑ‰ª∂ÁîüÊàêÂô®')
  console.log('================================')

  try {
    // Ê£ÄÊü•ÂΩìÂâçÊòØÂê¶Âú®Ê≠£Á°ÆÁöÑÁõÆÂΩï
    const packageJsonPath = path.join(process.cwd(), 'package.json')
    if (!fs.existsSync(packageJsonPath)) {
      throw new Error('ËØ∑Âú®È°πÁõÆÊ†πÁõÆÂΩï‰∏ãËøêË°åÊ≠§ËÑöÊú¨ (package.json ‰∏çÂ≠òÂú®)')
    }

    // Ëé∑ÂèñÁî®Êà∑ËæìÂÖ•
    const componentName = await askQuestion('ËØ∑ËæìÂÖ•ÁªÑ‰ª∂ÂêçÁß∞ (PascalCase, ‰æãÂ¶Ç: MyCustomComponent): ')
    const componentDisplayName = await askQuestion('ËØ∑ËæìÂÖ•ÁªÑ‰ª∂ÊòæÁ§∫ÂêçÁß∞ (‰æãÂ¶Ç: ÊàëÁöÑËá™ÂÆö‰πâÁªÑ‰ª∂): ')
    const componentDescription = await askQuestion('ËØ∑ËæìÂÖ•ÁªÑ‰ª∂ÊèèËø∞ (‰æãÂ¶Ç: ‰∏Ä‰∏™Ëá™ÂÆö‰πâÁöÑ‰∏öÂä°ÁªÑ‰ª∂): ')
    const componentType = await askComponentType()
    const iconName = (await askQuestion('ËØ∑ËæìÂÖ•ÂõæÊ†áÂêçÁß∞ (‰æãÂ¶Ç: icon-zidingyimokuai) [ÂèØÈÄâ]: ')) || 'icon-zidingyimokuai'

    // È™åËØÅËæìÂÖ•
    const validationErrors = validateInputs(
      componentName.trim(),
      componentDisplayName.trim(),
      componentDescription.trim()
    )
    if (validationErrors.length > 0) {
      console.log('‚ùå ËæìÂÖ•È™åËØÅÂ§±Ë¥•:')
      validationErrors.forEach((error) => console.log(`   - ${error}`))
      process.exit(1)
    }

    const trimmedComponentName = componentName.trim()
    const trimmedDisplayName = componentDisplayName.trim()
    const trimmedDescription = componentDescription.trim()
    const trimmedIconName = iconName.trim()

    // Ê£ÄÊü•ÁªÑ‰ª∂ÊòØÂê¶Â∑≤Â≠òÂú®
    const existingFiles = checkComponentExists(trimmedComponentName)
    if (existingFiles.length > 0) {
      console.log('‚ö†Ô∏è  Ë≠¶Âëä: ‰ª•‰∏ãÊñá‰ª∂/ÁõÆÂΩïÂ∑≤Â≠òÂú®:')
      existingFiles.forEach((file) => console.log(`   - ${file}`))
      const overwrite = await askQuestion('ÊòØÂê¶Ë¶ÅË¶ÜÁõñÁé∞ÊúâÊñá‰ª∂? (y/N): ')
      if (!overwrite.toLowerCase().startsWith('y')) {
        console.log('‚ùå Êìç‰ΩúÂ∑≤ÂèñÊ∂à')
        process.exit(0)
      }
    }

    console.log('\nüîß Ê≠£Âú®ÁîüÊàêÁªÑ‰ª∂Êñá‰ª∂...')

    // ÁîüÊàêÊñá‰ª∂Ë∑ØÂæÑ
    const basePath = path.join(process.cwd(), 'src/views/WebVision/components')
    const componentPath = path.join(basePath, 'componentsbiz', trimmedComponentName)
    const stylePath = path.join(basePath, 'rightslider', `${trimmedComponentName}Style`)
    const propertiesPath = path.join(basePath, 'componentsbiz/componentProperties')

    // ÁîüÊàêÊñá‰ª∂ÂÜÖÂÆπ
    const mainComponentContent =
      componentType === 'dynamic'
        ? generateDynamicComponent(trimmedComponentName, trimmedDisplayName, trimmedDescription)
        : generateStaticComponent(trimmedComponentName, trimmedDisplayName, trimmedDescription)
    const typeContent = generateTypeFile(trimmedComponentName, trimmedDisplayName, componentType)
    const styleContent = generateStyleComponent(trimmedComponentName, trimmedDisplayName, componentType)
    const propertiesContent = generatePropertiesFile(
      trimmedComponentName,
      trimmedDisplayName,
      trimmedDescription,
      componentType
    )

    // ÂÜôÂÖ•Êñá‰ª∂
    writeFile(path.join(componentPath, 'index.vue'), mainComponentContent)
    writeFile(path.join(componentPath, 'type.ts'), typeContent)
    writeFile(path.join(stylePath, 'index.vue'), styleContent)
    writeFile(path.join(propertiesPath, `${trimmedComponentName}.ts`), propertiesContent)

    console.log('‚úÖ ÁªÑ‰ª∂Êñá‰ª∂ÁîüÊàêÂÆåÊàê')

    // Êõ¥Êñ∞Á¥¢ÂºïÊñá‰ª∂
    console.log('üîÑ Êõ¥Êñ∞ÈÖçÁΩÆÊñá‰ª∂...')
    updateComponentPropertiesIndex(trimmedComponentName)
    updateSliderAssembly(trimmedComponentName, trimmedDisplayName, trimmedIconName)

    console.log('‚úÖ ÈÖçÁΩÆÊñá‰ª∂Êõ¥Êñ∞ÂÆåÊàê')
    console.log('\nüéâ ÁªÑ‰ª∂ÁîüÊàêÊàêÂäü!')
    console.log('================================')
    console.log(`ÁªÑ‰ª∂ÂêçÁß∞: ${trimmedComponentName}`)
    console.log(`ÊòæÁ§∫ÂêçÁß∞: ${trimmedDisplayName}`)
    console.log(`ÁªÑ‰ª∂Á±ªÂûã: ${componentType === 'dynamic' ? 'Âä®ÊÄÅÁªÑ‰ª∂ (Dynamic)' : 'ÈùôÊÄÅÁªÑ‰ª∂ (Static)'}`)
    console.log(`ÊèèËø∞: ${trimmedDescription}`)
    console.log(`ÂõæÊ†á: ${trimmedIconName}`)
    console.log('================================')
    console.log('üìÅ ÁîüÊàêÁöÑÊñá‰ª∂:')
    console.log(`  - src/views/WebVision/components/componentsbiz/${trimmedComponentName}/index.vue`)
    console.log(`  - src/views/WebVision/components/componentsbiz/${trimmedComponentName}/type.ts`)
    console.log(`  - src/views/WebVision/components/rightslider/${trimmedComponentName}Style/index.vue`)
    console.log(`  - src/views/WebVision/components/componentsbiz/componentProperties/${trimmedComponentName}.ts`)
    console.log('\nüîÑ Êõ¥Êñ∞ÁöÑÊñá‰ª∂:')
    console.log('  - src/views/WebVision/components/componentsbiz/componentProperties/index.ts')
    console.log('  - src/views/WebVision/components/sliderassembly/index.vue')
    console.log('\nüí° ÊèêÁ§∫: ËØ∑ÈáçÂêØÂºÄÂèëÊúçÂä°Âô®‰ª•Êü•ÁúãÊñ∞ÁªÑ‰ª∂')
  } catch (error) {
    console.error('‚ùå ÁîüÊàêËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØ:', error.message)
    if (error.stack) {
      console.error('ÈîôËØØËØ¶ÊÉÖ:', error.stack)
    }
    process.exit(1)
  } finally {
    rl.close()
  }
}

// ËøêË°å‰∏ªÂáΩÊï∞
main()
