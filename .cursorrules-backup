# WebVisioné¡¹ç›® Cursor Rules
# å¯è§†åŒ–é¡µé¢æ„å»ºå™¨ç³»ç»Ÿå¼€å‘è§„èŒƒ

## é¡¹ç›®æ¦‚è¿°
è¿™æ˜¯ä¸€ä¸ªåŸºäºVue 3 + TypeScript + Viteçš„å¯è§†åŒ–é¡µé¢æ„å»ºå™¨ç³»ç»Ÿ(WebVision)ï¼Œæ”¯æŒæ‹–æ‹½å¼é¡µé¢æ­å»ºã€å¤šæ¨¡å¼ç¼–è¾‘å’Œå®æ—¶é¢„è§ˆåŠŸèƒ½ã€‚

## æ ¸å¿ƒæŠ€æœ¯æ ˆ
- Vue 3 + Composition API + TypeScript
- Viteæ„å»ºå·¥å…·
- Element Plus + Vant UIç»„ä»¶åº“
- vuedraggableæ‹–æ‹½åŠŸèƒ½
- PiniaçŠ¶æ€ç®¡ç†
- SCSS/CSSæ ·å¼

## å¼€å‘è§„èŒƒ

### 1. æ–‡ä»¶å‘½åå’Œç»„ç»‡è§„èŒƒ
- **æ–‡ä»¶å¤¹å‘½å**: ä½¿ç”¨camelCaseé©¼å³°å‘½å (å¦‚: `WebVision`, `componentsbiz`)
- **Vueç»„ä»¶æ–‡ä»¶**: ä½¿ç”¨kebab-caseå‘½å (å¦‚: `index.vue`, `page-builder.vue`)
- **TypeScriptæ–‡ä»¶**: ä½¿ç”¨camelCaseå‘½å (å¦‚: `type.ts`, `middleComponent.ts`)
- **æ ·å¼ç»„ä»¶åç¼€**: å³ä¾§é…ç½®ç»„ä»¶ç»Ÿä¸€ä½¿ç”¨`style`åç¼€ (å¦‚: `noticestyle`, `magiccubestyle`)

### 2. Vueç»„ä»¶å¼€å‘è§„èŒƒ
```vue
<!-- æ ‡å‡†ç»„ä»¶ç»“æ„ -->
<template>
  <!-- ä½¿ç”¨è¯­ä¹‰åŒ–HTMLæ ‡ç­¾ -->
  <div class="component-name">
    <!-- Element Plusç»„ä»¶ä¼˜å…ˆï¼ŒVantç”¨äºç§»åŠ¨ç«¯é¢„è§ˆ -->
  </div>
</template>

<script setup lang="ts">
import { reactive, ref, computed } from 'vue'
import type { ComponentProps } from './type'

// Propså®šä¹‰
interface Props {
  datas?: ComponentProps
}

const props = withDefaults(defineProps<Props>(), {
  datas: () => ({})
})

// å“åº”å¼æ•°æ®ä½¿ç”¨ref/reactive
const isLoading = ref(false)
const formData = reactive({})
</script>

<style lang="scss" scoped>
.component-name {
  // ä½¿ç”¨SCSSåµŒå¥—è¯­æ³•
}
</style>
```

### 3. WebVisionç‰¹æœ‰ç»„ä»¶è§„èŒƒ

#### 3.1 å·¦ä¾§ç»„ä»¶åº“ç»„ä»¶ (`components/sliderassembly`)
- ç»„ä»¶éœ€è¦æ”¯æŒæ‹–æ‹½åŠŸèƒ½
- å¿…é¡»åŒ…å«ç»„ä»¶é¢„è§ˆå›¾æ ‡æˆ–ç¼©ç•¥å›¾
- æŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç±» (`componentsbiz`, `componentscom`)

#### 3.2 ä¸­é—´é¢„è§ˆåŒºç»„ä»¶ (`components/componentscom`, `components/componentsbiz`)
```typescript
// æ ‡å‡†ç»„ä»¶æ¥å£
interface ComponentStyle {
  componentType: string
  componentId: string
  componentName: string
  configParamJson: string
  isView: 'y' | 'n'
  status?: 'y' | 'n'
}

// ç»„ä»¶å¿…é¡»æ”¯æŒçš„Props
interface ComponentProps {
  datas: ComponentStyle
}
```

#### 3.3 å³ä¾§é…ç½®é¢æ¿ç»„ä»¶ (`components/rightslider`)
- é…ç½®ç»„ä»¶å¿…é¡»åŒ…å«è¡¨å•éªŒè¯
- æ”¯æŒè§†å›¾æ¨¡å¼å’ŒJSONæ¨¡å¼åŒé‡ç¼–è¾‘
- å®æ—¶é¢„è§ˆé…ç½®å˜åŒ–
- ç»„ä»¶æ–‡ä»¶åå¿…é¡»ä»¥`style`ç»“å°¾ (å¦‚: `noticestyle/index.vue`)

### 4. ç±»å‹å®šä¹‰è§„èŒƒ
```typescript
// åœ¨ type.ts ä¸­å®šä¹‰æ¥å£
export interface PageSetup {
  name: string
  details?: string
  isPerson?: boolean
  isBack?: boolean
  titleHeight?: number
  bgColor?: string
  bgImg?: string
}

export interface PageComponent {
  active?: boolean
  type: number
  component: string
  componentId?: string
  componentRef?: string
  componentType?: string
  configParamJson?: string
  templateId?: string
  websiteId?: string
  setStyle?: ComponentStyle
  pageRenderingSeq?: number
  style?: string
  text?: string
  selected?: boolean
}

// Dataæ¥å£åŒ…å«å®Œæ•´é¡µé¢æ•°æ®
export interface Data {
  id: number | null
  pageSetup: PageSetup
  demo?: string
  pageComponents: PageComponent[]
}

// Chooseæ¥å£ç®¡ç†ç»„ä»¶é€‰æ‹©çŠ¶æ€
export interface Choose {
  deleShow: boolean
  index: number
  tab: string
  currCompName: string
  rightcom: string
  currentproperties: unknown
  offsetY: number
  onlyOne: string[]
  pointer: { show: boolean }
}

// ä½¿ç”¨è”åˆç±»å‹å®šä¹‰æ¨¡å¼
export type PageMode = 'websiteMode' | 'templateMode' | 'componentMode'
```

### 5. APIè°ƒç”¨è§„èŒƒ
```typescript
// APIè°ƒç”¨ç»Ÿä¸€å¤„ç†
const isLoading = ref(false)

const getData = async (params: QueryParams) => {
  try {
    isLoading.value = true
    const res = await apiMethod(params)
    if (res.success && res.data) {
      // å¤„ç†æ•°æ®
      data.value = res.data.list || []
      total.value = res.data.total || 0
    }
  } catch (error) {
    ElMessage.error('è¯·æ±‚å¤±è´¥')
  } finally {
    isLoading.value = false
  }
}
```

### 6. ç»„ä»¶æ³¨å†Œå’Œæ˜ å°„è§„èŒƒ
```typescript
// åœ¨ const/middleComponent.ts ä¸­æ³¨å†Œä¸­é—´é¢„è§ˆç»„ä»¶
import type { Component } from 'vue'
import custommodule from '../components/componentscom/custommodule/index.vue'
import notice from '../components/componentscom/notice/index.vue'

interface ComponentMap {
  [key: string]: Component
}

export const componentMap: ComponentMap = {
  custommodule: custommodule,
  notice: notice,
  placementarea: placementarea
  // ... å…¶ä»–ç»„ä»¶
}

// åœ¨ const/rightComponent.ts ä¸­æ³¨å†Œå³ä¾§é…ç½®ç»„ä»¶
import type { Component } from 'vue'
import custommodulestyle from '../components/rightslider/custommodulestyle/index.vue'
import noticestyle from '../components/rightslider/noticestyle/index.vue'

interface ComponentMap {
  [key: string]: Component
}

export const componentRightMap: ComponentMap = {
  custommodulestyle,
  noticestyle,
  templateStyle,
  websiteStyle,
  // ... å…¶ä»–é…ç½®ç»„ä»¶
}
```

### 7. æ ·å¼è§„èŒƒ
```scss
// ä½¿ç”¨BEMå‘½åè§„èŒƒ
.component-name {
  &__element {
    // å…ƒç´ æ ·å¼
  }
  
  &--modifier {
    // ä¿®é¥°ç¬¦æ ·å¼
  }
  
  // å“åº”å¼è®¾è®¡
  @media (max-width: 768px) {
    // ç§»åŠ¨ç«¯æ ·å¼
  }
}

// WebVisionç‰¹æœ‰æ ·å¼ç±»
.phone-container {
  // æ‰‹æœºé¢„è§ˆå®¹å™¨æ ·å¼
  background-color: var(--bg-color);
  background-image: var(--bg-image);
}

.componentsClass {
  // åŠ¨æ€ç»„ä»¶åŸºç¡€æ ·å¼
  position: relative;
}

.pointer-events {
  // æ‹–æ‹½æ—¶çš„æŒ‡é’ˆç©¿é€æ ·å¼
  pointer-events: none;
}

.deles {
  // ç»„ä»¶åˆ é™¤æŒ‰é’®æ ·å¼
  position: absolute;
  top: 0;
  right: 0;
  background: rgba(21, 91, 212, 0.8);
  color: white;
  padding: 2px 6px;
  font-size: 12px;
  z-index: 1000;
}

// çŠ¶æ€æ æ ·å¼
.statusBar {
  width: 100%;
  position: relative;
}

// æ‰‹æœºå°ºå¯¸æç¤º
.phoneSize {
  text-align: center;
  font-size: 12px;
  color: #999;
}
```

### 8. æ‹–æ‹½åŠŸèƒ½è§„èŒƒ
```vue
<template>
  <!-- ä¸»è¦æ‹–æ‹½åŒºåŸŸä½¿ç”¨draggableç»„ä»¶ -->
  <draggable
    :list="pageComponents"
    item-key="index"
    :forceFallback="true"
    :animation="200"
    @sort="saveTemRend"
  >
    <template #item="{ element, index }">
      <component
        :is="componentMap[element.component]"
        :datas="element.setStyle"
        :style="{
          border: element.active && deleShow ? '2px solid #155bd4' : ''
        }"
        @click="activeComponent(element, index)"
        class="componentsClass"
        :data-type="element.type"
      >
        <!-- åˆ é™¤æŒ‰é’®æ’æ§½ -->
        <template #deles>
          <div v-show="deleShow" class="deles">
            <span class="icon-triangle"></span>
            <span class="deles-icon-text">{{ element.setStyle.componentName }}</span>
          </div>
        </template>
      </component>
    </template>
  </draggable>

  <!-- å³ä¾§é…ç½®é¢æ¿ä¸­çš„æ’åºæ‹–æ‹½ -->
  <vuedraggable 
    :list="data" 
    :disabled="false" 
    class="list-group" 
    ghost-class="ghost" 
    :move="checkMove"
  >
    <template #item="{ element, index }">
      <!-- æ’åºé¡¹æ¨¡æ¿ -->
    </template>
  </vuedraggable>
</template>

<script setup lang="ts">
import draggable from 'vuedraggable'
import vuedraggable from 'vuedraggable' // æ³¨æ„ï¼šé¡¹ç›®ä¸­åŒæ—¶ä½¿ç”¨ä¸¤ç§å¯¼å…¥æ–¹å¼
</script>
```

### 9. çŠ¶æ€ç®¡ç†è§„èŒƒ
```typescript
// ä½¿ç”¨reactiveç®¡ç†å¤æ‚çŠ¶æ€
const datas = reactive<Data>({
  id: null,
  pageSetup: {
    name: 'é¡µé¢æ ‡é¢˜',
    details: '',
    isPerson: false,
    isBack: true,
    titleHeight: 35,
    bgColor: 'rgba(249, 249, 249, 10)',
    bgImg: ''
  },
  pageComponents: []
})

// ä½¿ç”¨reactiveç®¡ç†é€‰æ‹©çŠ¶æ€
const choose = reactive<Choose>({
  deleShow: true,
  index: 0,
  rightcom: 'decorate', // é»˜è®¤å³ä¾§ç»„ä»¶
  currentproperties: datas.pageSetup,
  offsetY: 0,
  onlyOne: ['1-5', '1-16', 'onlyOne', 'header', 'footer'],
  pointer: { show: false }
})

```

### 10. é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
import { ElMessage, ElMessageBox } from 'element-plus'

// æˆåŠŸåé¦ˆ
ElMessage.success('æ“ä½œæˆåŠŸ')

// é”™è¯¯åé¦ˆ  
ElMessage.error('æ“ä½œå¤±è´¥')

// åŠ è½½çŠ¶æ€
const isLoading = ref(false)

// ç¡®è®¤å¯¹è¯æ¡†
ElMessageBox.confirm('ç¡®å®šåˆ é™¤è¯¥ç»„ä»¶ï¼Ÿ', 'æç¤º', {
  confirmButtonText: 'ç¡®å®š',
  cancelButtonText: 'å–æ¶ˆ',
  type: 'warning'
}).then(() => {
  // ç¡®è®¤æ“ä½œ
}).catch(() => {
  // å–æ¶ˆæ“ä½œ
})
```

### 11. æ¨¡å¼åˆ‡æ¢å’ŒTabç®¡ç†
```typescript
// ä¸‰ç§é¡µé¢æ¨¡å¼
type PageMode = 'websiteMode' | 'templateMode' | 'componentMode'

// Tabé¡µé¢ç®¡ç†
const activeTab = ref('0') // é»˜è®¤ç«™ç‚¹è®¾ç½®
const isEditJSON = ref(true) // JSONæ¨¡å¼å¼€å…³

// æ¨¡å¼åˆ‡æ¢å‡½æ•°
const toggleEditJSON = () => {
  isEditJSON.value = !isEditJSON.value
}

// Tabåˆ‡æ¢å¤„ç†
const onTabChange = (tab: string) => {
  // å¤„ç†tabåˆ‡æ¢é€»è¾‘
}
```

### 12. ç»„ä»¶æ¿€æ´»å’Œé€‰æ‹©è§„èŒƒ
```typescript
// ç»„ä»¶æ¿€æ´»å‡½æ•°
const activeComponent = (res: SelectComponent, index: number) => {
  console.log('ğŸš€ ~ activeComponent ~ res:', res)
  activeTab.value = '2' // åˆ‡æ¢åˆ°ç»„ä»¶è®¾ç½®Tab
  choose.index = index
  choose.rightcom = res.style // åˆ‡æ¢å³ä¾§é…ç½®ç»„ä»¶
  choose.currentproperties = res.setStyle // æ›´æ–°å½“å‰å±æ€§
  
  // é‡ç½®æ‰€æœ‰ç»„ä»¶é€‰ä¸­çŠ¶æ€
  datas.pageComponents.forEach((item) => {
    if (item.active === true) item.active = false
  })
  
  // è®¾ç½®å½“å‰ç»„ä»¶ä¸ºé€‰ä¸­çŠ¶æ€
  res.active = true
}
```

### 13. å›¾ç‰‡å¤„ç†è§„èŒƒ
```vue
<template>
  <!-- ç¦ç”¨å›¾ç‰‡æ‹–æ‹½é¿å…å†²çª -->
  <img draggable="false" :src="imageSrc" alt="" />
  
  <!-- æ¡ä»¶æ¸²æŸ“å›¾ç‰‡ -->
  <img 
    draggable="false" 
    v-if="datas.imageUrl" 
    :src="datas.imageUrl" 
    alt="" 
  />
  <img 
    draggable="false" 
    v-else 
    src="@/assets/images/default.png" 
    alt="" 
  />
</template>
```

### 14. æ€§èƒ½ä¼˜åŒ–è§„èŒƒ
- ä½¿ç”¨ `markRaw()` åŒ…è£…ç»„ä»¶é˜²æ­¢å“åº”å¼è½¬æ¢ï¼ˆè™½ç„¶é¡¹ç›®ä¸­æ³¨é‡Šäº†ä½†ä»å»ºè®®ä½¿ç”¨ï¼‰
- å¤§åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- å›¾ç‰‡ç»Ÿä¸€è®¾ç½® `draggable="false"` é¿å…æ‹–æ‹½å†²çª
- é€‚å½“ä½¿ç”¨ `shallowRef` å’Œ `shallowReactive`

### 15. è°ƒè¯•å’Œå¼€å‘å·¥å…·
```typescript
// å¼€å‘ç¯å¢ƒè°ƒè¯•
if (import.meta.env.DEV) {
  console.log('Debug info:', data)
}

// é¡¹ç›®ä¸­ä¿ç•™çš„è°ƒè¯•ä¿¡æ¯
console.log('~~~~~~~~~~~', viewComps.componentPage.persistentComponent)
```

### 16. ç‰¹å®šä¸šåŠ¡è§„åˆ™
- æ”¯æŒä¸‰ç§é¡µé¢æ¨¡å¼ï¼šç«™ç‚¹æ¨¡å¼ã€æ¨¡æ¿æ¨¡å¼ã€ç»„ä»¶æ¨¡å¼
- ç»„ä»¶é…ç½®æ”¯æŒJSONå’Œè§†å›¾åŒæ¨¡å¼ç¼–è¾‘
- æ‰‹æœºé¢„è§ˆå°ºå¯¸æ ‡æ³¨ä¸º"iPhone 12proæ‰‹æœºé«˜åº¦"
- æ‹–æ‹½ç»„ä»¶æ—¶æ˜¾ç¤ºè¾¹æ¡†å’Œåˆ é™¤æŒ‰é’®
- é…ç½®å˜æ›´éœ€è¦å®æ—¶ä¿å­˜å’Œé¢„è§ˆ
- æŸäº›ç»„ä»¶åªèƒ½å­˜åœ¨ä¸€ä¸ª (`onlyOne` æ•°ç»„æ§åˆ¶)

### 17. APIé›†æˆè§„èŒƒ
```typescript
// WebVisionç›¸å…³APIå¯¼å…¥
import { getSysComponent } from '@/api/webgw/sysCompent'
import { 
  addTemplateComponent, 
  getComponentList, 
  getTemplateComponent, 
  updatePageRenderingSeq 
} from '@/api/webgw/template'
import { 
  addWebsiteComponent, 
  findWebsiteComponent, 
  updateSitePageRenderingSeq 
} from '@/api/webgw/websit'

// ç±»å‹å¯¼å…¥
import type { IGetSysComponentQueryParams, TableData } from '@/api/webgw/sysCompent/types'
import type { 
  IGetComponentListQueryParams, 
  IGetTemplateComponentQueryParams, 
  TableData as TempTableData 
} from '@/api/webgw/template/types'
```

### 18. æƒé™å’Œå®‰å…¨
```typescript
// æƒé™åˆ¤æ–­ï¼ˆåŸºäºé¡¹ç›®å®é™…æƒ…å†µï¼‰
const hasPermission = (permission: string) => {
  return per.includes(permission)
}

// ä½¿ç”¨ç¤ºä¾‹
if (hasPermission('webvision:edit')) {
  // æ‰§è¡Œç¼–è¾‘æ“ä½œ
}
```

### 19. ä¼šè¯å­˜å‚¨è§„èŒƒ
```typescript
// ä½¿ç”¨é¡¹ç›®å°è£…çš„ä¼šè¯ç¼“å­˜
import { sessionCache } from '@/hooks/useSession'

// å­˜å‚¨æ•°æ®
sessionCache.set('webvision-data', componentData)

// è·å–æ•°æ®
const cachedData = sessionCache.get('webvision-data')
```

## ä»£ç è´¨é‡æ£€æŸ¥
- ä½¿ç”¨ESLintè¿›è¡Œä»£ç æ£€æŸ¥
- ä½¿ç”¨Prettierè¿›è¡Œä»£ç æ ¼å¼åŒ–
- TypeScriptä¸¥æ ¼æ¨¡å¼æ£€æŸ¥
- æäº¤å‰å¿…é¡»é€šè¿‡æ‰€æœ‰æ£€æŸ¥

## æ³¨æ„äº‹é¡¹
1. æ–°å¢ç»„ä»¶å¿…é¡»åŒæ—¶æ›´æ–° `componentMap` å’Œ `componentRightMap` ä¸¤ä¸ªæ˜ å°„è¡¨
2. é…ç½®é¡¹å˜æ›´éœ€è¦æ›´æ–°ç±»å‹å®šä¹‰
3. æ ·å¼ä¿®æ”¹éœ€è¦è€ƒè™‘ç§»åŠ¨ç«¯é€‚é…
4. APIæ¥å£å˜æ›´éœ€è¦æ›´æ–°ç±»å‹å®šä¹‰
5. æ‰€æœ‰ç”¨æˆ·æ“ä½œéœ€è¦æä¾›åé¦ˆ
6. ç¡®ä¿æ‹–æ‹½åŠŸèƒ½çš„æµç•…æ€§å’Œç¨³å®šæ€§
7. å›¾ç‰‡ç»„ä»¶å¿…é¡»è®¾ç½® `draggable="false"` é¿å…æ‹–æ‹½å†²çª
8. å³ä¾§é…ç½®ç»„ä»¶æ–‡ä»¶åå¿…é¡»ä»¥ `style` ç»“å°¾

éµå¾ªä»¥ä¸Šè§„èŒƒå¯ä»¥ç¡®ä¿WebVisioné¡¹ç›®çš„ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œæ•ˆç‡ã€‚